library(ggplot2)
library(ggrepel)
library(reshape2)
library(ggpubr)
library(ggsci)
setwd("~/Research/GWAS-frontera/PGS")
df <- read.csv("pgs_linear_results_five.txt", sep="\t")
# inc r2
#df <- df[c(-3,-4,-7,-8,-11,-12)]
# r2
df <- df[c(-5,-6,-9,-10,-13,-14)]
df$Sex[df$Sex == 'male'] <- 'm'
df$Sex[df$Sex == 'female'] <- 'f'
df_combined <- df[df$Sex == 'combined',]
df_sep <- df[df$Sex != 'combined',]
df_sep$Phenotype <- paste0(df_sep$Phenotype,"_",df_sep$Sex)
melt_out <- function(df) {
df1 <- melt(df[c(1,2,3,5,7)], id.vars = c('Phenotype','Sex'),
variable.name = "r2_var", value.name = "r2_val")
df2 <- melt(df[c(1,2,4,6,8)], id.vars = c('Phenotype','Sex'),
variable.name = "r2_var", value.name = "r2_se_val")
df2$r2_var <- df1$r2_var
df <- merge(df1,df2, by=c('Phenotype','Sex','r2_var'))
df <- df[order(df$Phenotype, decreasing = FALSE),]
return(df)
}
df_sep <- melt_out(df_sep)
df_combined <- melt_out(df_combined)
# formate df_combined for analysis
df_combined = dcast(df_combined, Phenotype ~ r2_var, value.var="r2_val")
# ttest for difference between additive and mash
df_add <- df_combined[df_combined$r2_var == "_r2", c(1,4,5)]
df_mash <- df_combined[df_combined$r2_var == "m_r2",c(1,4,5)]
setwd("~/Research/GWAS-frontera/PGS")
df <- read.csv("pgs_linear_results_five.txt", sep="\t")
# inc r2
#df <- df[c(-3,-4,-7,-8,-11,-12)]
# r2
df <- df[c(-5,-6,-9,-10,-13,-14)]
df$Sex[df$Sex == 'male'] <- 'm'
df$Sex[df$Sex == 'female'] <- 'f'
df_combined <- df[df$Sex == 'combined',]
df_sep <- df[df$Sex != 'combined',]
df_sep$Phenotype <- paste0(df_sep$Phenotype,"_",df_sep$Sex)
melt_out <- function(df) {
df1 <- melt(df[c(1,2,3,5,7)], id.vars = c('Phenotype','Sex'),
variable.name = "r2_var", value.name = "r2_val")
df2 <- melt(df[c(1,2,4,6,8)], id.vars = c('Phenotype','Sex'),
variable.name = "r2_var", value.name = "r2_se_val")
df2$r2_var <- df1$r2_var
df <- merge(df1,df2, by=c('Phenotype','Sex','r2_var'))
df <- df[order(df$Phenotype, decreasing = FALSE),]
return(df)
}
df_sep <- melt_out(df_sep)
df_combined <- melt_out(df_combined)
# formate df_combined for analysis
df_combined = dcast(df_combined, Phenotype ~ r2_var, value.var="r2_val")
# ttest for difference between additive and mash
df_add <- df_combined[df_combined$r2_var == "_r2", c(1,4,5)]
head(df_combined)
# ttest for difference between additive and mash
df_add <- df_combined[df_combined$r2_var == "_r2", c(1,2)]
df_mash <- df_combined[df_combined$r2_var == "m_r2",c(1,4)]
df_add <- df_add %>%
mutate(mean_diff = r2_val - df_mash$r2_val) %>%
mutate(se_diff = sqrt((df_add$r2_se_val)^2 + (df_mash$r2_se_val)^2) ) %>%
mutate(ttest = mean_diff - se_diff)
