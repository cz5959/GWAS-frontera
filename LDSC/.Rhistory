require("dplyr")
require("tidyr")
require("ggplot2")
require("grid")
require("gridExtra")
require("ggpubr")
setwd("~/Research/GWAS-frontera/LDSC")
df <- read.csv("ldsc_results.txt", sep="\t")
both_h2 <- rep(df[df$Sex == "both_sex", "Heritability"], each=3)
asterick_pheno <- c("arm_fatfree_mass_R", "weight", "arm_fatfree_mass_L", "bmi",
"whole_body_fat_mass", "waist_circ", "hip_circ", "waist_to_hip_ratio")
df <- df %>%
mutate(relative_h2 = Heritability / both_h2) %>%
mutate(relative_h2_se = ((Heritability + h2.std.error) / both_h2) - relative_h2 ) %>%
mutate(Sex = factor(Sex, levels=c("female","both_sex","male"))) %>%
mutate(star = ifelse((Code %in% asterick_pheno) & (Sex == 'both_sex'), "*", NA)) %>%
arrange(Correlation, Phenotype, Sex) %>%
mutate(Phenotype = factor(Phenotype, levels=unique(Phenotype)))
#write.table(df, file = "relative_h2.txt", quote=FALSE, sep="\t", row.names=FALSE)
# relative heritability diff by correlation
df <- df[df$Sex != 'both_sex', c(1,3,6,8,9)]
f <- df[df$Sex == 'female',]
m <- df[df$Sex == 'male',]
setwd("~/Research/GWAS-frontera/LDSC")
df <- read.csv("ldsc_results.txt", sep="\t")
test <- data.frame(c(1,2,3,4,5), c(1.4,2,5,1,5.8))
test
test <- data.frame(a = c(1,2,3,4,5), b = c(1.4,2,5,1,5.8))
test
round(test,3)
round(test,1)
lapply(test, function(x) round(x))
test <- lapply(test, function(x) round(x))
test
test[] <- lapply(test, function(x) round(x))
test
require("dplyr")
mutate(test, across(), round, 2)
test <- data.frame(a = c(1,2,3,4,5), b = c(1.4,2,5,1,5.8))
mutate(test, across(), round, 2)
mutate(test, round, 2)
test <- data.frame(a = c(1,2,3,4,5), b = c(1.4,2,5,1,5.8))
mutate(test, round, 2)
mutate(test, across(everything()) round, 2)
mutate(test, across(everything()), round, 2)
test <- data.frame(a = c(1,2,3,4,5), b = c(1.4,2,5,1,5.8))
test
mutate(test, across(everything(), round, 2))
mutate(test, across(everything(), round, 1))
mutate(test, across(everything(), round, 0))
mutate(test, across(everything(), round, 8))
9000000
9000000 * 0.0000000001
0.0009
9000000 * 0.000000000001
9000000 * 0.0000000001
0.0009
library(ggplot2)
library(ggrepel)
library(ggsci)
library(reshape2)
library(ggbreak)
library(dplyr)
library(gridExtra)
library(grid)
library(ggpubr)
#write.table(pheno_var, file="pheno_var.txt", sep="\t", row.names=FALSE, quote=FALSE)
#write.table(pheno_var, file="pheno_var2.txt",sep="\t",row.names = FALSE, quote=FALSE)
#pheno_var <- read.csv("pheno_var.txt", sep="\t")
setwd("~/Research/GWAS-frontera/Phenotypes")
pheno_var <- read.csv("pheno_var_bootstrap.txt", sep="\t")
# get heritability
setwd("~/Research/GWAS-frontera/LDSC")
ldsc_df <- read.csv("ldsc_results.txt", sep="\t")
ldsc_df <- ldsc_df[c(1,2,3,4,5)] ; ldsc_df <- ldsc_df[ldsc_df$Sex != 'both_sex',]
ldsc_se <- dcast(ldsc_df, Code + Phenotype ~ Sex, value.var = c("h2.std.error"))
ldsc_df <- dcast(ldsc_df, Code ~ Sex, value.var = c("Heritability"))
colnames(ldsc_df) <- c("pheno","f_h2","m_h2") ; colnames(ldsc_se) <- c("pheno","pheno_name","f_h2_se","m_h2_se")
ldsc_df <- ldsc_df %>%
mutate(f_h2e = 1-f_h2) %>%
mutate(m_h2e = 1-m_h2)
# merge variance and heritability dataframe
df <- merge(merge(pheno_var, ldsc_df, by='pheno'), ldsc_se, by='pheno')
df <- df %>%
mutate(geno_var_m = m_h2*m_var) %>% mutate(geno_var_f = f_h2*f_var) %>%
mutate(env_var_m = m_h2e*m_var) %>% mutate(env_var_f = f_h2e*f_var) %>%
mutate(geno_se_m = sqrt((m_varse^2*m_h2_se^2)+(m_h2^2*m_varse^2)+(m_var^2*m_h2_se^2))) %>%
mutate(geno_se_f = sqrt((f_varse^2*f_h2_se^2)+(f_h2^2*f_varse^2)+(f_var^2*f_h2_se^2))) %>%
mutate(env_se_m = sqrt((m_varse^2*m_h2_se^2)+(m_h2e^2*m_varse^2)+(m_var^2*m_h2_se^2))) %>%
mutate(env_se_f = sqrt((f_varse^2*f_h2_se^2)+(f_h2e^2*f_varse^2)+(f_var^2*f_h2_se^2))) %>%
# calculate ratio
mutate(geno_var_ratio = geno_var_m/geno_var_f) %>%
mutate(env_var_ratio = env_var_m/env_var_f) %>%
# estimate standard error of ratio
mutate(geno_var_ratio_se =
(geno_var_ratio)*sqrt((geno_se_m^2/geno_var_m^2)+(geno_se_f^2/geno_var_f^2)) ) %>%
mutate(env_var_ratio_se =
(env_var_ratio)*sqrt((env_se_m^2/env_var_m^2)+(env_se_f^2/env_var_f^2))) %>%
select(c(1,10,21,22,23,24))
## pvalue error bars
head(df)
x <- df$geno_var_ratio; x.se <- df$geno_var_ratio_se
y <- df$env_var_ratio; y.se <- df$env_var_ratio_se
se_ratio <- (x/y)*sqrt((x.se^2/x^2)+(y.se^2/y^2))
df$ratio_se <- se_ratio
CI <- df$ratio_se * 1.645    ## 90% confidence interval
CI_side <- CI/sqrt(2)
df <- df %>%
mutate(ci_x1 = geno_var_ratio - CI_side) %>%
mutate(ci_x2 = geno_var_ratio + CI_side) %>%
mutate(ci_y1 = env_var_ratio - CI_side) %>%
mutate(ci_y2 = env_var_ratio + CI_side)
head(df)
df[df$pheno %in% c("wth_bmi_adj", "testosterone", "systolicVP_auto", "diastolicBP_auto", "creatinine",
"arm_fatfree_mass_L", "arm_fatfree_mass_R")]
df[df$pheno %in% c("wth_bmi_adj", "testosterone", "systolicVP_auto", "diastolicBP_auto", "creatinine",
"arm_fatfree_mass_L", "arm_fatfree_mass_R"),c(1,4)]
