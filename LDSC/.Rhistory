theme(axis.text=element_blank(), axis.title=element_blank(), axis.ticks=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, segment.alpha=0.5)
g4 <- ggplot(data=df1, aes(x= geno_var_ratio, y= env_var_ratio, color=on)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se, ymax=env_var_ratio+env_var_ratio_se),
width=0, position="dodge") +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
scale_x_continuous(breaks=c(0.5,1,1.5), limits=c(0.25,1.75)) +
theme(axis.text.x=element_text(), axis.title=element_blank(), legend.position = "none") +
geom_text_repel(data=(df1_1), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(2.2,NA)) +
geom_text_repel(data=(df1_2), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(NA,0.4))
g5 <- ggplot(data=df2, aes(x= geno_var_ratio, y= env_var_ratio)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se,
ymax=env_var_ratio+env_var_ratio_se), width=0) +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se), height=0) +
scale_x_continuous(breaks=c(3,3.4,3.8), limits=c(3,3.9)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(0,2.5))
g6 <- ggplot(empty_df) + geom_point() +
scale_x_continuous(breaks=c(77.715), limits=c(77.70,77.73)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank())
gA <- ggplotGrob(g1) ; gB <- ggplotGrob(g4)
maxWidth = grid::unit.pmax(gA$widths[2:5], gB$widths[2:5])
gA$widths[2:5] <- as.list(maxWidth) ; gB$widths[2:5] <- as.list(maxWidth)
plot <- grid.arrange(gA, g2, g3, gB, g5, g6, ncol=3, nrow=2, widths=c(6,2,1), heights=c(1,4))
annotate_figure(plot,
bottom = text_grob("Genetic Variance Ratio", size=10),
left = text_grob("Environmental Variance Ratio", size=10, rot=90),
top = text_grob("Genetic Variance Ratio to \n Environmental Variance Ratio", face = "bold", size = 14))
## GRID EXTRA PLOTTING
df1 <- df[! df$pheno %in% c('arm_fatfree_mass_L', 'arm_fatfree_mass_R', 'testosterone'),]
df1 <- mutate(df1, on = ifelse(abs(env_var_ratio-geno_var_ratio) <= env_var_ratio_se |
abs(geno_var_ratio-env_var_ratio) <= geno_var_ratio_se, 2,1))
df1_1 <- df1[(df1$env_var_ratio/df1$geno_var_ratio) >=1,]
df1_2 <- df1[df1$env_var_ratio/df1$geno_var_ratio <1,]
df2 <- df[df$pheno %in% c('arm_fatfree_mass_L', 'arm_fatfree_mass_R'),]
df3 <- df[df$pheno == 'testosterone',]
empty_df <- data.frame()
g1 <- ggplot(empty_df) + geom_point() +
scale_y_continuous(breaks=c(24.116), limits=c(23.45,24.78)) +
scale_x_continuous(breaks=c(0.5,1,1.5), limits=c(0.25,1.75)) +
theme(axis.text.x=element_blank(), axis.title=element_blank(), axis.ticks.x=element_blank())
g2 <- ggplot(empty_df) + geom_point() +
scale_x_continuous(breaks=c(3,3.4,3.8), limits=c(3,3.9)) +
scale_y_continuous(breaks=c(24.116), limits=c(23.45,24.78)) +
theme(axis.text=element_blank(), axis.title=element_blank(), axis.ticks=element_blank() )
g3 <- ggplot(data=df3, aes(x= geno_var_ratio, y= env_var_ratio)) +
geom_point(size=2, alpha=0.5) +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se, ymax=env_var_ratio+env_var_ratio_se), width=0) +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se), height=0) +
scale_y_continuous(breaks=c(24.116), limits=c(23.4,24.8)) +
scale_x_continuous(breaks=c(77.715), limits=c(64.35,91.07)) +
theme(axis.text=element_blank(), axis.title=element_blank(), axis.ticks=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, segment.alpha=0.5)
g4 <- ggplot(data=df1, aes(x= geno_var_ratio, y= env_var_ratio, color=on)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se, ymax=env_var_ratio+env_var_ratio_se),
width=0, position="dodge") +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
scale_x_continuous(breaks=c(0.5,1,1.5), limits=c(0.25,1.75)) +
theme(axis.text.x=element_text(), axis.title=element_blank(), legend.position = "none") +
geom_text_repel(data=(df1_1), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(2.2,NA)) +
geom_text_repel(data=(df1_2), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(NA,0.4))
g5 <- ggplot(data=df2, aes(x= geno_var_ratio, y= env_var_ratio)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se,
ymax=env_var_ratio+env_var_ratio_se), width=0) +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se), height=0) +
scale_x_continuous(breaks=c(3,3.4,3.8), limits=c(3,3.9)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(0,2.5))
g6 <- ggplot(empty_df) + geom_point() +
scale_x_continuous(breaks=c(77.715), limits=c(77.70,77.73)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank())
gA <- ggplotGrob(g1) ; gB <- ggplotGrob(g4)
maxWidth = grid::unit.pmax(gA$widths[2:5], gB$widths[2:5])
gA$widths[2:5] <- as.list(maxWidth) ; gB$widths[2:5] <- as.list(maxWidth)
plot <- grid.arrange(gA, g2, g3, gB, g5, g6, ncol=3, nrow=2, widths=c(6,2,1), heights=c(1,4))
annotate_figure(plot,
bottom = text_grob("Genetic Variance Ratio", size=10),
left = text_grob("Environmental Variance Ratio", size=10, rot=90),
top = text_grob("Genetic Variance Ratio to \n Environmental Variance Ratio", face = "bold", size = 14))
require("dplyr")
require("tidyr")
require("ggplot2")
require("gridExtra")
require("ggpubr")
pheno <- 'height'
pheno_name <- "Height"
setwd("~/Research/GWAS-frontera/GWAS_Results/height")
file_name <- paste0("male_sample.",pheno,".glm.linear")
male_df <- read.csv(file_name, sep="\t", colClasses=c(rep("integer",2),"character",rep("NULL",9),"numeric" ),nrow=1000)
female_df <- read.csv(file_name, sep="\t", colClasses=c(rep("integer",2),"character",rep("NULL",9),"numeric" ),nrow=1000)
edit_df <- function(df) {
plot_df <- df %>%
drop_na() %>%
group_by(X.CHROM) %>%
summarize(CHR_LEN=max(POS)) %>%
mutate(TOT=cumsum(as.numeric(CHR_LEN))-CHR_LEN) %>%
select(-CHR_LEN) %>%
left_join(df, ., by=c("X.CHROM"="X.CHROM")) %>%
arrange(X.CHROM, POS) %>%
mutate(POS_CUM=POS+TOT) %>%
mutate(COLOR=ifelse(X.CHROM %% 2, 1,2))
return(plot_df)
}
x_axis <- function(plot_df) {
axis_df <- plot_df %>%
group_by(X.CHROM) %>%
summarize(CENTER=(max(POS_CUM)+min(POS_CUM))/2 )
return(axis_df)
}
female_df <- edit_df(female_df)
male_df <- edit_df(male_df)
axis_df <- x_axis(female_df)
female_plot <- ggplot(female_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_continuous(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none", axis.title.x = element_blank(), plot.margin = margin(20,20,0,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(title=paste0("Miami Plot - ", pheno_name), y="Female")
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_clean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_classic() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_line(linetype=1)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
female_plot <- ggplot(female_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_continuous(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none", axis.title.x = element_blank(), plot.margin = margin(20,20,0,20),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(title=paste0("Miami Plot - ", pheno_name), y="Female")
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,0),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
#dev.off()
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_line(linetype=2)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_line(linetype=1)) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
male_plot <- ggplot(male_df, aes(x=POS_CUM,y=-log10(P))) +
geom_point( aes(color=as.factor(COLOR)), alpha=0.7, size=1) +
scale_x_continuous(label=axis_df$X.CHROM, breaks=axis_df$CENTER) +
scale_y_reverse(expand=c(0,0)) +
theme_pubclean() +
theme(legend.position = "none",  axis.text.x=element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0,20,20,20),
axis.text = element_text(size=11), panel.grid.major.y=element_blank()) +
scale_color_npg() +
labs(x="Chromosome",y="Male")
p <- grid.arrange(female_plot, male_plot, nrow = 2, left=textGrob("-log10(P)",rot=90,vjust=1))
p
55%%10
55/10
60/10
55/10
for (i in 0:floor(55/10)) {
beg = i*10
end = num - (10 + beg)
print(i, beg, end)
}
num=55
for (i in 0:floor(num/10)) {
beg = i*10
end = num - (10 + beg)
print(i, beg, end)
}
num=55
for (i in 0:floor(num/10)) {
beg = i*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
num=55
for (i in 0:floor(num/10)) {
beg = (i-1)*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
for (i in 1:floor(num/10)) {
beg = (i-1)*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
for (i in 1:ceiling(num/10)) {
beg = (i-1)*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
num=60
for (i in 1:ceiling(num/10)) {
beg = (i-1)*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
num=55
for (i in 1:ceiling(num/10)) {
beg = (i-1)*10
end = num - (10 + beg)
print(paste(i, beg, end))
}
set <- 2
for (num in set:set+2) {
print(num-set+2)
}
for (num in set:(set+2)) {
print(num-set+2)
}
print(num-set+3)
for (num in set:(set+2)) {
print(num-set+3)
}
head(mtcars)
head(mtcars[,!carb])
head( select(mtcars, carb) )
head( select(mtcars, -carb) )
pheno <- "height"
setwd("~/Research/GWAS-frontera/OLD/GWAS_Results_OLD/height")
df <- read.csv(paste0(pheno,"mixprop_100_all.txt"), sep="\t")
### simulation
setwd("~/Research/GWAS-frontera/mash/simulation")
df2 <- read.csv("5000_0.5_5.txt", sep="\t")
df2 <- data.frame(cbind(df$mix_0, df2$x))
colnames(df2) <- c("Name", "Mean")
df_values <- df2
# split matrice names
df_values <- df_values %>%
separate(Name, c("sex","correlation","effect"), sep="[_]", fill="right") %>%
mutate(effect = paste0(sex, effect))
prepare_df <- function(df) {
df$effect <- factor(df$effect, levels = c('f1','f3', 'f2', 'f1.5','equal1','m1.5','m2','m3','m1'))
df <- df %>% mutate_at(1, as.numeric) %>%
arrange(correlation, effect)
return(df)
}
# split between null and values
df_ave <- prepare_df(df_values[2:nrow(df_values),c(2,3,4)])
df_null <- prepare_df(df_values[1,c(2,3,4)])
df_null$Mean <- as.numeric(df_null$Mean)
df_ave$Mean <- as.numeric(df_ave$Mean)
big <- ggplot(df_ave, aes(x= effect, y= correlation, fill= Mean)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=round(Mean,3)), color= "white", size= 4) +
scale_y_continuous(expand=c(0,0)) +
labs(title="Weights of Hypothesis Matrices", xlab="Magnitude", ylab="Correlation") +
theme_pubclean() +
theme(axis.text=element_text(size=12), legend.position = "none") +
scale_fill_material("blue-grey")
small <- ggplot(df_null, aes(x= 0, y= 0, fill= Mean)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=round(Mean,3)), color= "white", size= 4) +
scale_y_continuous(expand=c(0,0)) +
labs(title="Weight of No Effect Matrice", xlab="Magnitude", ylab="Correlation") +
theme_pubclean() +
theme(axis.text=element_blank(), axis.title=element_blank(), legend.position = "none",
axis.ticks = element_blank(), plot.title = element_text(size=10)) +
scale_fill_material("blue-grey")
lay <- rbind( c(1,1,1,1), c(1,1,1,1), c(1,1,1,1), c(1,1,1,1), c(2,3,3,3))
p <- gridExtra::grid.arrange(big, small, ncol=1, layout_matrix=lay)
library(ggplot2)
library(ggrepel)
library(ggsci)
library(reshape2)
library(ggbreak)
library(dplyr)
library(gridExtra)
library(grid)
library(ggpubr)
# get phenotypic variance
setwd("~/Research/GWAS-frontera/Phenotypes")
pheno_var <- NULL
pheno_list <- c("height","bmi","testosterone","RBC_count","IGF1","creatinine","weight","calcium",
"protein_total","whole_body_fat_mass","urate","arm_fatfree_mass_L",
"arm_fatfree_mass_R", "eosinophil_perc", "lymphocyte_perc", "waist_circ",
"hip_circ", "waist_to_hip", "wth_bmi_adj","diastolicBP_auto","systolicBP_auto",
"albumin", "pulse_rate")
df_sex <- read.csv("sex_ids.txt", sep="\t")
for (pheno in pheno_list) {
df_pheno <- read.csv(paste0("pheno_",pheno,".txt"), sep="\t", colClasses = c("NULL","integer","numeric"))
df_pheno <- merge(df_pheno, df_sex, by='IID')
m <- df_pheno[df_pheno$sex == 1, 2] ; f <- df_pheno[df_pheno$sex == 0, 2]
male_var <- var(m) ; male_varse <- sqrt((2*male_var^2) / (length(m)-1))
female_var <- var(f) ; female_varse <- sqrt((2*female_var^2) / (length(f)-1))
pheno_var <- rbind(pheno_var, data.frame(pheno=pheno, m_var=male_var, f_var=female_var,
m_varse=male_varse, f_varse=female_varse))
}
# get heritability
setwd("~/Research/GWAS-frontera/LDSC")
ldsc_df <- read.csv("ldsc_results.txt", sep="\t")
ldsc_df <- ldsc_df[c(1,3,4,5)] ; ldsc_df <- ldsc_df[ldsc_df$Sex != 'both_sex',]
ldsc_se <- dcast(ldsc_df, Code ~ Sex, value.var = c("h2.std.error"))
ldsc_df <- dcast(ldsc_df, Code ~ Sex, value.var = c("Heritability"))
colnames(ldsc_df) <- c("pheno","f_h2","m_h2") ; colnames(ldsc_se) <- c("pheno","f_h2_se","m_h2_se")
ldsc_df <- ldsc_df %>%
mutate(f_h2e = 1-f_h2) %>%
mutate(m_h2e = 1-m_h2)
# merge variance and heritability dataframe
df <- merge(merge(pheno_var, ldsc_df, by='pheno'), ldsc_se, by='pheno')
df <- df %>%
mutate(geno_var_m = m_h2*m_var) %>% mutate(geno_var_f = f_h2*f_var) %>%
mutate(env_var_m = m_h2e*m_var) %>% mutate(env_var_f = f_h2e*f_var) %>%
mutate(geno_se_m = sqrt((m_varse^2*m_h2_se^2)+(m_h2^2*m_varse^2)+(m_var^2*m_h2_se^2))) %>%
mutate(geno_se_f = sqrt((f_varse^2*f_h2_se^2)+(f_h2^2*f_varse^2)+(f_var^2*f_h2_se^2))) %>%
mutate(env_se_m = sqrt((m_varse^2*m_h2_se^2)+(m_h2e^2*m_varse^2)+(m_var^2*m_h2_se^2))) %>%
mutate(env_se_f = sqrt((f_varse^2*f_h2_se^2)+(f_h2e^2*f_varse^2)+(f_var^2*f_h2_se^2))) %>%
# calculate ratio
mutate(geno_var_ratio = geno_var_m/geno_var_f) %>%
mutate(env_var_ratio = env_var_m/env_var_f) %>%
# estimate standard error of ratio
mutate(geno_var_ratio_se =
(geno_var_ratio)*sqrt((geno_se_m^2/geno_var_m^2)+(geno_se_f^2/geno_var_f^2)) ) %>%
mutate(env_var_ratio_se =
(env_var_ratio)*sqrt((env_se_m^2/env_var_m^2)+(env_se_f^2/env_var_f^2))) %>%
select(c(1,20,21,22,23))
# ggplot
df$facet_y[df$env_var_ratio <= 10] <- 2
df$facet_y[df$env_var_ratio > 10] <- 1
df$facet_x[df$geno_var_ratio <= 2] <- 1
df$facet_x[df$geno_var_ratio > 3] <- 2
df$facet_x[df$geno_var_ratio > 10] <- 3
## GRID EXTRA PLOTTING
df1 <- df[! df$pheno %in% c('arm_fatfree_mass_L', 'arm_fatfree_mass_R', 'testosterone'),]
df1 <- mutate(df1, on = ifelse(abs(env_var_ratio-geno_var_ratio) <= env_var_ratio_se |
abs(geno_var_ratio-env_var_ratio) <= geno_var_ratio_se, 2,1))
df1_1 <- df1[(df1$env_var_ratio/df1$geno_var_ratio) >=1,]
df1_2 <- df1[df1$env_var_ratio/df1$geno_var_ratio <1,]
df2 <- df[df$pheno %in% c('arm_fatfree_mass_L', 'arm_fatfree_mass_R'),]
df3 <- df[df$pheno == 'testosterone',]
empty_df <- data.frame()
g1 <- ggplot(empty_df) + geom_point() +
scale_y_continuous(breaks=c(24.116), limits=c(23.45,24.78)) +
scale_x_continuous(breaks=c(0.5,1,1.5), limits=c(0.25,1.75)) +
theme(axis.text.x=element_blank(), axis.title=element_blank(), axis.ticks.x=element_blank())
g2 <- ggplot(empty_df) + geom_point() +
scale_x_continuous(breaks=c(3,3.4,3.8), limits=c(3,3.9)) +
scale_y_continuous(breaks=c(24.116), limits=c(23.45,24.78)) +
theme(axis.text=element_blank(), axis.title=element_blank(), axis.ticks=element_blank() )
g3 <- ggplot(data=df3, aes(x= geno_var_ratio, y= env_var_ratio)) +
geom_point(size=2, alpha=0.5) +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se, ymax=env_var_ratio+env_var_ratio_se), width=0) +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se), height=0) +
scale_y_continuous(breaks=c(24.116), limits=c(23.4,24.8)) +
scale_x_continuous(breaks=c(77.715), limits=c(64.35,91.07)) +
theme(axis.text=element_blank(), axis.title=element_blank(), axis.ticks=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, segment.alpha=0.5)
g4 <- ggplot(data=df1, aes(x= geno_var_ratio, y= env_var_ratio, color=on)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se, ymax=env_var_ratio+env_var_ratio_se),
width=0, position="dodge") +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
scale_x_continuous(breaks=c(0.5,1,1.5), limits=c(0.25,1.75)) +
theme(axis.text.x=element_text(), axis.title=element_blank(), legend.position = "none") +
geom_text_repel(data=(df1_1), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(2.2,NA)) +
geom_text_repel(data=(df1_2), aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(NA,0.4))
g5 <- ggplot(data=df2, aes(x= geno_var_ratio, y= env_var_ratio)) +
geom_point(size=2, alpha=0.5) + geom_abline(slope = 1, intercept = 0, color='red') +
geom_errorbar(aes(y=env_var_ratio, ymin=env_var_ratio-env_var_ratio_se,
ymax=env_var_ratio+env_var_ratio_se), width=0) +
geom_errorbarh(aes(y=env_var_ratio, xmin=geno_var_ratio-geno_var_ratio_se, xmax=geno_var_ratio+geno_var_ratio_se), height=0) +
scale_x_continuous(breaks=c(3,3.4,3.8), limits=c(3,3.9)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank()) +
geom_text_repel(aes(label=pheno), size=3, max.overlaps=Inf, segment.alpha=0.5,
ylim=c(0,2.5))
g6 <- ggplot(empty_df) + geom_point() +
scale_x_continuous(breaks=c(77.715), limits=c(77.70,77.73)) +
scale_y_continuous(breaks=c(1,2,3), limits=c(0,3.5)) +
theme(axis.text.y=element_blank(), axis.title=element_blank(), axis.ticks.y=element_blank())
gA <- ggplotGrob(g1) ; gB <- ggplotGrob(g4)
maxWidth = grid::unit.pmax(gA$widths[2:5], gB$widths[2:5])
gA$widths[2:5] <- as.list(maxWidth) ; gB$widths[2:5] <- as.list(maxWidth)
plot <- grid.arrange(gA, g2, g3, gB, g5, g6, ncol=3, nrow=2, widths=c(6,2,1), heights=c(1,4))
annotate_figure(plot,
bottom = text_grob("Genetic Variance Ratio", size=10),
left = text_grob("Environmental Variance Ratio", size=10, rot=90),
top = text_grob("Genetic Variance Ratio to \n Environmental Variance Ratio", face = "bold", size = 14))
