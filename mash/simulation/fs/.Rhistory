ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=interaction(model,phenotype)),
data=df2, alpha=0.4, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype), df2, linetype=2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#870c16","#8a575b","#2b62d9","#2f62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=interaction(model,phenotype)),
data=df2, alpha=0.4, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype), df2, linetype=2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#870c16","#8a575b","#0339ad","#7e8ca8")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=interaction(model,phenotype)),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype), df2, linetype=2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#870c16","#8a575b","#0339ad","#7e8ca8")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype), df2, linetype=2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype), df2, linetype=2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model+1), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("twodash","dotted"))
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("twodash","dotted")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("dashed","dotted"), labels=) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"), labels=) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="right")
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top") +
guide_legend(nrow=2)
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top") +
guides(color=guide_legend(nrow=2))
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top") +
guides(fill=guide_legend(nrow=2))
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top") +
guides(linetype=guide_legend(nrow=2))
ggplot(df, aes(x=perc, y=ah_inc_r2, color=phenotype)) +
geom_point() +
geom_errorbar(aes(ymin=ah_inc_r2-3*ah_inc_r2_se, ymax=ah_inc_r2+3*ah_inc_r2_se),
width=0.2, position=position_dodge(0.05)) +
geom_rect(aes(xmin=48, xmax=102, ymin=ah_inc_r2-3*ah_inc_r2_se,
ymax=ah_inc_r2+3*ah_inc_r2_se, fill=phenotype),
data=df2, alpha=0.2, linetype=0, show.legend = FALSE) +
geom_hline(aes(yintercept=ah_inc_r2, color=phenotype, linetype=model), df2) +
labs(x="% total sample size", y="incremental R^2") +
theme_classic() +
scale_color_manual(values = c("#b0464f","#2b62d9")) +
scale_fill_manual(values = c("#b0464f","#2b62d9")) +
scale_linetype_manual(values=c("longdash","dotted"),
labels=c("Sex-specific additive","Sex-specific covariance aware")) +
scale_x_continuous(expand=c(0,0), limits=c(48,102), breaks=seq(50,100,10)) +
theme(legend.position="top") +
guides(linetype=guide_legend(nrow=2), color=guide_legend(nrow=2))
setwd("~/Research/GWAS-frontera/mash/")
m_names <- read.csv("matrice_names.txt", sep="\t")
setwd("~/Research/GWAS-frontera/mash/simulation/fs")
# f=18
# m=64
# s=2
# snps=1000
# same="same"
#
# name <- paste0("mash_",snps,"_nonnull_",f,"_",m,"_",s,"_",same)
name <- "mash_1000_0.16_fs_ttest"
df <- read.csv(paste0(name,".txt"), sep="\t")
x <- rowSums(df)/10
df <- data.frame(cbind(m_names[1:4], x))
df$effect <- paste0(df$sex, df$magnitude)
prepare_df <- function(df) {
df$effect <- factor(df$effect, levels = c('f1','f3', 'f2', 'f1.5','equal1','m1.5','m2','m3','m1'))
df <- df %>% mutate_at(1, as.numeric) %>%
arrange(correlation, effect)
return(df)
}
df_nonnull <- prepare_df(df[2:nrow(df),c(3,5,6)])
df_null <- prepare_df(df[1,c(3,5,6)])
# format labels
df_nonnull <- df_nonnull %>%
mutate(x = as.numeric(x)) %>%
mutate(mean_lab = ifelse(x < 0.0005, "0%", sprintf("%.1f%%", round(x*100,1)) ))
df_null <- df_null %>%
mutate(x = as.numeric(x)) %>%
mutate(mean_lab = ifelse(x < 0.0005, "0%", sprintf("%.1f%%", round(x*100,1)) ))
### BIG PLOT
effect_labels <-  c('female-\nspecific','female x3', 'female x2', 'female x1.5','equal','male x1.5','male x2','male x3','male-\nspecific')
png(file=paste0(name,".png"), width=6.5, height=4.8, units="in", res=300)
big <- ggplot(df_nonnull, aes(x= effect, y= correlation, fill= x)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=mean_lab), color= "black", size= 2.7, vjust=-0.1) +
scale_y_continuous(breaks=seq(-1,1,0.25), expand=c(0,0)) +
scale_x_discrete(labels= effect_labels) +
#labs(title=paste0(f,"% female; ",m,"% male; x",s,"; snps=",snps,"; same sign")) +
xlab("Magnitude") + ylab("Correlation") +
theme_pubclean() +
theme(axis.text=element_text(size=9), axis.title = element_text(size=11), plot.title = element_text(size=14),
legend.position = "none") +
scale_fill_gradient(low="gray98",high="#829ed9")
small <- ggplot(df_null, aes(x= 0, y= 0, fill= x)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=mean_lab), color= "white", size= 2.7, vjust=-0.1) +
scale_y_continuous(expand=c(0,0)) +
ylab("Weight of \nNo Effect Matrix") +
theme_pubclean() +
theme(axis.text=element_blank(), axis.title=element_blank(),
axis.title.y = element_text(size=10, angle=360, vjust=0.5),
legend.position = "none",axis.ticks = element_blank(), plot.title = element_blank()) +
scale_fill_gradient(low="#2b62d9",high="#2b62d9")
lay <- rbind( c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(2,2,3,3,3))
p <- gridExtra::grid.arrange(big, small, ncol=1, layout_matrix=lay)
dev.off()
### SMALL PLOT
nan_weight <- 1 / (1 - df_null$x[1])
df_nonnull$x = df_nonnull$x * nan_weight
df_nonnull$effect <- as.character(df_nonnull$effect) ; df_nonnull$correlation <- as.numeric(df_nonnull$correlation)
# group by sex
group_sex <- function(sex){
df_sex <- df_nonnull %>% filter(substr(effect,1,1) == sex) %>%
group_by(correlation) %>%
summarise(mean_sum = sum(x)) %>%
as.data.frame()
return(df_sex)
}
for (s in c('f','m','e')) {
assign(s, group_sex(s))
}
df_small <- data.frame(cbind(e[,1], f[,2], e[,2], m[,2])); colnames(df_small) <- c('corr', 'F', 'E', 'M')
df_small <- data.frame(rbind(
c('perfect', colSums(df_small[df_small$corr == 1, 2:4])),
c('partial,\npositive', colSums(df_small[(df_small$corr > 0) & (df_small$corr < 1), 2:4])),
c('uncorrelated', colSums(df_small[(df_small$corr == 0), 2:4])),
c('negative', colSums(df_small[(df_small$corr < 0), 2:4]))
))
colnames(df_small) <- c('corr', 'female > male', 'female = male', 'female < male')
df_small <- melt(df_small, id.vars=c('corr'))
df_small$corr <- factor(df_small$corr, levels = c('negative', 'uncorrelated', 'partial,\npositive', 'perfect'))
df_small$variable <- factor(df_small$variable, levels = c('female > male', 'female = male', 'female < male'))
df_small <- df_small %>% mutate_at(3, as.numeric) %>%
arrange(corr, variable)
colnames(df_small) <- c("correlation", "magnitude", "value")
sum_mag <- df_small %>%
group_by(magnitude) %>%
summarise(sum= sum(value))
sum_corr <- df_small %>%
group_by(correlation) %>%
summarise(sum = sum(value))
# PLOT
png(file=paste0(name,"_small.png"), width=3.5, height=2.3, units="in", res=200)
ggplot(df_small, aes(x=magnitude, y= correlation, fill= value)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=sprintf("%.0f%%", (value*100))), color= "black", size= 2.5) +
labs(title="Covariance of Genetic Effects: Compact Representation") +
xlab("Magnitude") + ylab("Correlation") +
theme_pubclean() +
# theme(axis.text=element_text(size=9), axis.title = element_text(size=10, hjust=0.5),
#        plot.title = element_text(size=11, hjust=1), legend.position = "none") +
theme(axis.text=element_text(size=8), axis.title = element_text(size=9, hjust=0.5),
plot.title = element_blank(), legend.position = "none") +
scale_x_discrete(position="top") +
scale_fill_gradient(low="gray98",high="#829ed9") +
annotate("text", x=1:3, y = 0.4, size = 2.8, label = sprintf("%.0f%%", (sum_mag$sum*100))) +
annotate("text", x = 3.65, y=1:4, size = 2.8, label = sprintf("%.0f%%", (sum_corr$sum*100))) +
coord_cartesian(xlim=c(1,3.15), ylim=c(0.9,3.9), clip="off")
dev.off()
# f=18
# m=64
# s=2
# snps=1000
# same="same"
#
# name <- paste0("mash_",snps,"_nonnull_",f,"_",m,"_",s,"_",same)
name <- "mash_1000_0.16_fs"
df <- read.csv(paste0(name,".txt"), sep="\t")
# f=18
# m=64
# s=2
# snps=1000
# same="same"
#
# name <- paste0("mash_",snps,"_nonnull_",f,"_",m,"_",s,"_",same)
name <- "mash_1000_0.16_fs_10s"
df <- read.csv(paste0(name,".txt"), sep="\t")
x <- rowSums(df)/10
df <- data.frame(cbind(m_names[1:4], x))
df$effect <- paste0(df$sex, df$magnitude)
prepare_df <- function(df) {
df$effect <- factor(df$effect, levels = c('f1','f3', 'f2', 'f1.5','equal1','m1.5','m2','m3','m1'))
df <- df %>% mutate_at(1, as.numeric) %>%
arrange(correlation, effect)
return(df)
}
df_nonnull <- prepare_df(df[2:nrow(df),c(3,5,6)])
df_null <- prepare_df(df[1,c(3,5,6)])
# format labels
df_nonnull <- df_nonnull %>%
mutate(x = as.numeric(x)) %>%
mutate(mean_lab = ifelse(x < 0.0005, "0%", sprintf("%.1f%%", round(x*100,1)) ))
df_null <- df_null %>%
mutate(x = as.numeric(x)) %>%
mutate(mean_lab = ifelse(x < 0.0005, "0%", sprintf("%.1f%%", round(x*100,1)) ))
### BIG PLOT
effect_labels <-  c('female-\nspecific','female x3', 'female x2', 'female x1.5','equal','male x1.5','male x2','male x3','male-\nspecific')
png(file=paste0(name,".png"), width=6.5, height=4.8, units="in", res=300)
big <- ggplot(df_nonnull, aes(x= effect, y= correlation, fill= x)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=mean_lab), color= "black", size= 2.7, vjust=-0.1) +
scale_y_continuous(breaks=seq(-1,1,0.25), expand=c(0,0)) +
scale_x_discrete(labels= effect_labels) +
#labs(title=paste0(f,"% female; ",m,"% male; x",s,"; snps=",snps,"; same sign")) +
xlab("Magnitude") + ylab("Correlation") +
theme_pubclean() +
theme(axis.text=element_text(size=9), axis.title = element_text(size=11), plot.title = element_text(size=14),
legend.position = "none") +
scale_fill_gradient(low="gray98",high="#829ed9")
small <- ggplot(df_null, aes(x= 0, y= 0, fill= x)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=mean_lab), color= "white", size= 2.7, vjust=-0.1) +
scale_y_continuous(expand=c(0,0)) +
ylab("Weight of \nNo Effect Matrix") +
theme_pubclean() +
theme(axis.text=element_blank(), axis.title=element_blank(),
axis.title.y = element_text(size=10, angle=360, vjust=0.5),
legend.position = "none",axis.ticks = element_blank(), plot.title = element_blank()) +
scale_fill_gradient(low="#2b62d9",high="#2b62d9")
lay <- rbind( c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(1,1,1,1,1), c(2,2,3,3,3))
p <- gridExtra::grid.arrange(big, small, ncol=1, layout_matrix=lay)
dev.off()
### SMALL PLOT
nan_weight <- 1 / (1 - df_null$x[1])
df_nonnull$x = df_nonnull$x * nan_weight
df_nonnull$effect <- as.character(df_nonnull$effect) ; df_nonnull$correlation <- as.numeric(df_nonnull$correlation)
# group by sex
group_sex <- function(sex){
df_sex <- df_nonnull %>% filter(substr(effect,1,1) == sex) %>%
group_by(correlation) %>%
summarise(mean_sum = sum(x)) %>%
as.data.frame()
return(df_sex)
}
for (s in c('f','m','e')) {
assign(s, group_sex(s))
}
df_small <- data.frame(cbind(e[,1], f[,2], e[,2], m[,2])); colnames(df_small) <- c('corr', 'F', 'E', 'M')
df_small <- data.frame(rbind(
c('perfect', colSums(df_small[df_small$corr == 1, 2:4])),
c('partial,\npositive', colSums(df_small[(df_small$corr > 0) & (df_small$corr < 1), 2:4])),
c('uncorrelated', colSums(df_small[(df_small$corr == 0), 2:4])),
c('negative', colSums(df_small[(df_small$corr < 0), 2:4]))
))
colnames(df_small) <- c('corr', 'female > male', 'female = male', 'female < male')
df_small <- melt(df_small, id.vars=c('corr'))
df_small$corr <- factor(df_small$corr, levels = c('negative', 'uncorrelated', 'partial,\npositive', 'perfect'))
df_small$variable <- factor(df_small$variable, levels = c('female > male', 'female = male', 'female < male'))
df_small <- df_small %>% mutate_at(3, as.numeric) %>%
arrange(corr, variable)
colnames(df_small) <- c("correlation", "magnitude", "value")
sum_mag <- df_small %>%
group_by(magnitude) %>%
summarise(sum= sum(value))
sum_corr <- df_small %>%
group_by(correlation) %>%
summarise(sum = sum(value))
# PLOT
png(file=paste0(name,"_small.png"), width=3.5, height=2.3, units="in", res=200)
ggplot(df_small, aes(x=magnitude, y= correlation, fill= value)) +
geom_tile(color= "white", lwd= 1.5, linetype= 1) +
geom_text(aes(label=sprintf("%.0f%%", (value*100))), color= "black", size= 2.5) +
labs(title="Covariance of Genetic Effects: Compact Representation") +
xlab("Magnitude") + ylab("Correlation") +
theme_pubclean() +
# theme(axis.text=element_text(size=9), axis.title = element_text(size=10, hjust=0.5),
#        plot.title = element_text(size=11, hjust=1), legend.position = "none") +
theme(axis.text=element_text(size=8), axis.title = element_text(size=9, hjust=0.5),
plot.title = element_blank(), legend.position = "none") +
scale_x_discrete(position="top") +
scale_fill_gradient(low="gray98",high="#829ed9") +
annotate("text", x=1:3, y = 0.4, size = 2.8, label = sprintf("%.0f%%", (sum_mag$sum*100))) +
annotate("text", x = 3.65, y=1:4, size = 2.8, label = sprintf("%.0f%%", (sum_corr$sum*100))) +
coord_cartesian(xlim=c(1,3.15), ylim=c(0.9,3.9), clip="off")
dev.off()
