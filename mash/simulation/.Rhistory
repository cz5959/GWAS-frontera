}
# get genotypes and betas for all snps
monomorphs <- NULL
h0.5_e1 <- NULL ; h0.5_e1.5 <- NULL ; h0.5_e5 <- NULL
h0.05_e1 <- NULL ; h0.05_e1.5 <- NULL ; h0.05_e5 <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
assign(paste0("h",h2,"_e",E_ratio,"[",i,"]"), gwas)
}
}
}
h0.5_e1
h0.5_e1[5]
'h0.5_e1[5]'
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
gwas
gwas[1]
gwas[1,]
gwas[,1]
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
head(mash_BETA)
(mash_BETA)
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
print(E)
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
print(head(E))
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
print(head(E))
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ tsnp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp[m_id] + E[m_id])
f_gwas <- summary(model)$coefficients[2,1:2]
m_gwas <- summary(model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
#mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
#mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp[m_id] + E[m_id])
f_gwas <- summary(model)$coefficients[2,1:2]
m_gwas <- summary(model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
#mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
#mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp_count[m_id] + E[m_id])
f_gwas <- summary(model)$coefficients[2,1:2]
m_gwas <- summary(model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
#mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
#mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp_count[m_id] + E[m_id])
f_gwas <- summary(f_model)$coefficients[2,1:2]
m_gwas <- summary(m_model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
#mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, BETA= gwas[1]))
#mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, SE= gwas[2]))
}
}
}
gwas
gwas[1,1]
gwas[1,2]
gwas[2,1]
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
mash_BETA
nrow(mash_BETA)
for (i in length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
print(i)
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in 1:length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
#if (snp_count == 'monomorphism') {       # check if snp is monomorphism
#  monomorphs[i] <- snpids[i]
#  next
#}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
mash_BETA
nrow(mash_BETA)
# get genotype at site i for all individuals
get_genotypes <- function(snpid) {
genotypes <- NULL
for (i in 1:length(sex)) {
genotype <- rbinom(n=2, size=1, prob=allele_freq$maf[snpid])
genotypes[i] <- sum(genotype)
}
if (length(unique(genotypes)) ==1) {
return('monomorphism')
} else {
return(genotypes)
}
}
# get environmental effect
get_environment <- function() {
var_G <- (Beta^2) * snp_af * (1-snp_af)   # genetic variance
var_E_m <- (var_G * (1-h2)) / h2          # environmental variance (males)
var_E_f <- var_E_m * E_ratio              # environmental variance for female based on proportion
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m))
}
}
return(E)
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp_count[m_id] + E[m_id])
f_gwas <- summary(f_model)$coefficients[2,1:2]
m_gwas <- summary(m_model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in 1:length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
if (snp_count == 'monomorphism') {       # check if snp is monomorphism
monomorphs[i] <- snpids[i]
next
}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
head(monomorphs)
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in 1:length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
if (snp_count.isna()) {       # check if snp is monomorphism
monomorphs[i] <- snpids[i]
next
}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in 1:length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
if (is.na(snp_count)) {       # check if snp is monomorphism
monomorphs[i] <- snpids[i]
next
}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
# get genotype at site i for all individuals
get_genotypes <- function(snpid) {
genotypes <- NULL
for (i in 1:length(sex)) {
genotype <- rbinom(n=2, size=1, prob=allele_freq$maf[snpid])
genotypes[i] <- sum(genotype)
}
if (length(unique(genotypes)) ==1) {
return(c(100))
} else {
return(genotypes)
}
}
# get environmental effect
get_environment <- function() {
var_G <- (Beta^2) * snp_af * (1-snp_af)   # genetic variance
var_E_m <- (var_G * (1-h2)) / h2          # environmental variance (males)
var_E_f <- var_E_m * E_ratio              # environmental variance for female based on proportion
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m))
}
}
return(E)
}
# get genotype at site i for all individuals
get_genotypes <- function(snpid) {
genotypes <- NULL
for (i in 1:length(sex)) {
genotype <- rbinom(n=2, size=1, prob=allele_freq$maf[snpid])
genotypes[i] <- sum(genotype)
}
if (length(unique(genotypes)) ==1) {
return(c(100))
} else {
return(genotypes)
}
}
# get environmental effect
get_environment <- function() {
var_G <- (Beta^2) * snp_af * (1-snp_af)   # genetic variance
var_E_m <- (var_G * (1-h2)) / h2          # environmental variance (males)
var_E_f <- var_E_m * E_ratio              # environmental variance for female based on proportion
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m))
}
}
return(E)
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp_count[m_id] + E[m_id])
f_gwas <- summary(f_model)$coefficients[2,1:2]
m_gwas <- summary(m_model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
# create sample of individuals -- random sex
# 0=female  1=male
sex <- rbinom(1000,1,0.5)
f_id <- which(sex==0)
m_id <- which(sex==1)
# set seed for sampling
set.seed(1)
# sample i causal SNPs from k genotypes
snp_num <- 5 ##############
snpids <- sample(1:nrow(allele_freq),snp_num)
# get genotype at site i for all individuals
get_genotypes <- function(snpid) {
genotypes <- NULL
for (i in 1:length(sex)) {
genotype <- rbinom(n=2, size=1, prob=allele_freq$maf[snpid])
genotypes[i] <- sum(genotype)
}
if (length(unique(genotypes)) ==1) {
return(c(100))
} else {
return(genotypes)
}
}
# get environmental effect
get_environment <- function() {
var_G <- (Beta^2) * snp_af * (1-snp_af)   # genetic variance
var_E_m <- (var_G * (1-h2)) / h2          # environmental variance (males)
var_E_f <- var_E_m * E_ratio              # environmental variance for female based on proportion
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m))
}
}
return(E)
}
GWAS <- function(E) {
pheno <- (Beta*snp_count) + E      # calculate phenotypes from Beta, snp i, and E
f_model <- lm(pheno[f_id] ~ snp_count[f_id] + E[f_id])
m_model <- lm(pheno[m_id] ~ snp_count[m_id] + E[m_id])
f_gwas <- summary(f_model)$coefficients[2,1:2]
m_gwas <- summary(m_model)$coefficients[2,1:2]
return(rbind(f_gwas,m_gwas))
}
# get genotypes and betas for all snps
monomorphs <- NULL
mash_BETA <- NULL
mash_SE <- NULL
for (i in 1:length(snpids)) {
snp_count <- get_genotypes(snpids[i])    # get allele count for all individuals
snp_af <- allele_freq$maf[snpids[i]]
if (length(snp_count) == 1) {       # check if snp is monomorphism
monomorphs[i] <- snpids[i]
next
}
Beta <- rnorm(1, mean=0, sd=1)          # sample effect size B from normal distribution
for (h2 in c(0.5, 0.05)) {
for (E_ratio in c(1, 1.5, 5)) {
E <- get_environment()
gwas <- GWAS(E)
mash_BETA <- rbind(mash_BETA, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[1,1], male= gwas[2,1]))
mash_SE <- rbind(mash_SE, data.frame(h2= h2, E_ratio=E_ratio, female= gwas[2,1], male= gwas[2,2]))
}
}
}
monomorphs
snpids
mash_BETA
head(mash_BETA)
