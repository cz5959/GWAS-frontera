pheno <- colSums(Beta*snp) + E
### GWAS ###
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
f_gwas <- summary(f_model)$coefficients[2:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[2:snp_num+1,1:2]
mash_BETA <-  matrix(c(f_gwas[,1],m_gwas[,1]), nrow=snp_num, ncol=2)
head(f_gwas)
nrow(f_gwas)
nrow(summary(f_model)$coefficients)
tail(f_gwas)
f_gwas <- summary(f_model)$coefficients[2:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[2:snp_num+1,1:2]
tail(f_gwas)
f_gwas <- summary(f_model)$coefficients[2:snp_num+2,1:2]
m_gwas <- summary(m_model)$coefficients[2:snp_num+1,1:2]
tail(f_gwas)
f_gwas <- summary(f_model)$coefficients[2:snp_num+1,1:2]
tail(f_gwas)
head(f_gwas)
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
head(f_gwas)
head(summary(f_model)$coefficients)
head(summary(f_model)$coefficients[0])
head(summary(f_model)$coefficients[0])
head(summary(f_model)$coefficients[1])
head(summary(f_model)$coefficients[2])
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[2:snp_num+1,1:2]
heaD(f_gwas)
heaD(f_model)
head(f_model)
head(f_gwas)
head(m_gwas)
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
mash_BETA <-  matrix(c(f_gwas[,1],m_gwas[,1]), nrow=snp_num, ncol=2)
mash_SE <-  matrix(c(f_gwas[,2],m_gwas[,2]), nrow=snp_num, ncol=2)
colnames(mash_BETA) <- c('female','male') ; colnames(mash_SE) <- c('female','male')
### mash ###
data <- mash_set_data(mash_BETA, mash_SE)
# create sample of individuals -- random sex
# 0=female  1=male
sex <- rbinom(100,1,0.5)   ### 350k ## if statement to remove monomorphism
######################heat plots
f_id <- which(sex==0)
m_id <- which(sex==1)
# get genotype from binom sampling at site k with allele freq
allele_freq <- read.csv("maf_sample.txt", colClasses = 'numeric')
# sample i causal SNPs from k genotypes
snp_num <- 100 ##############
snp <- NULL
snp_af <- NULL
for (i in 1:length(sex)) {
snp_idx <- sample(1:nrow(allele_freq), snp_num)
snp <- cbind(snp, allele_count[snp_idx] )       # row: snp  col: individual
snp_af <- cbind(snp_af, allele_freq$maf[snp_idx])
}
# sample effect size B from normal distribution
Beta <- rnorm(snp_num, mean=0, sd=1)
# genetic variance for each individuals
var_G <- colSums((Beta^2) * snp_af * (1-snp_af))
# environmental variance for males from heritability
h2 <- 0.5 ##############
var_E_m <- (var_G * (1-h2)) / h2
# environmental variance for female based on proportion
E_ratio <- 1.5 ##############
var_E_f <- var_E_m * E_ratio
# environmental effect for males and females from normal distribution
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
# calculate phenotypes from Beta, snp i, and E for j individuals
pheno <- colSums(Beta*snp) + E
### GWAS ###
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
nrow(summary(f_model)$coefficients)
# sample i causal SNPs from k genotypes
snp_num <- 100 ##############
snp <- NULL
snp_af <- NULL
for (i in 1:length(sex)) {
snp_idx <- sample(1:nrow(allele_freq), snp_num)
snp <- cbind(snp, allele_count[snp_idx] )       # row: snp  col: individual
snp_af <- cbind(snp_af, allele_freq$maf[snp_idx])
}
# sample effect size B from normal distribution
Beta <- rnorm(snp_num, mean=0, sd=1)
# genetic variance for each individuals
var_G <- colSums((Beta^2) * snp_af * (1-snp_af))
# environmental variance for males from heritability
h2 <- 0.5 ##############
var_E_m <- (var_G * (1-h2)) / h2
# environmental variance for female based on proportion
E_ratio <- 1.5 ##############
var_E_f <- var_E_m * E_ratio
# environmental effect for males and females from normal distribution
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
# calculate phenotypes from Beta, snp i, and E for j individuals
pheno <- colSums(Beta*snp) + E
head(pheno)
length(pheno)
### GWAS ###
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
nrow(f_model)
nrow(summary(f_model)$coefficients)
head(summary(f_model)$coefficients)
tail(summary(f_model)$coefficients)
# create sample of individuals -- random sex
# 0=female  1=male
sex <- rbinom(100,1,0.5)   ### 350k ## if statement to remove monomorphism
######################heat plots
f_id <- which(sex==0)
m_id <- which(sex==1)
# get genotype from binom sampling at site k with allele freq
allele_freq <- read.csv("maf_sample.txt", colClasses = 'numeric')
set.seed(1)
allele_count <- NULL
for (i in 1:nrow(allele_freq)){
test <- rbinom(n=2, size=1, prob=allele_freq$maf[i])
allele_count[i] <- sum(test)
}
# sample i causal SNPs from k genotypes
snp_num <- 100 ##############
snp <- NULL
snp_af <- NULL
for (i in 1:length(sex)) {
snp_idx <- sample(1:nrow(allele_freq), snp_num)
snp <- cbind(snp, allele_count[snp_idx] )       # row: snp  col: individual
snp_af <- cbind(snp_af, allele_freq$maf[snp_idx])
}
# sample effect size B from normal distribution
Beta <- rnorm(snp_num, mean=0, sd=1)
# genetic variance for each individuals
var_G <- colSums((Beta^2) * snp_af * (1-snp_af))
# environmental variance for males from heritability
h2 <- 0.5 ##############
var_E_m <- (var_G * (1-h2)) / h2
# environmental variance for female based on proportion
E_ratio <- 1.5 ##############
var_E_f <- var_E_m * E_ratio
# environmental effect for males and females from normal distribution
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
# calculate phenotypes from Beta, snp i, and E for j individuals
pheno <- colSums(Beta*snp) + E
### GWAS ###
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
head(f_gwas)
tail(f_gwas)
head(summary(f_model)$coefficients)
tail(summary(f_model)$coefficients)
# create sample of individuals -- random sex
# 0=female  1=male
sex <- rbinom(10000,1,0.5)   ### 350k ## if statement to remove monomorphism
######################heat plots
f_id <- which(sex==0)
m_id <- which(sex==1)
set.seed(1)
allele_count <- NULL
for (i in 1:nrow(allele_freq)){
test <- rbinom(n=2, size=1, prob=allele_freq$maf[i])
allele_count[i] <- sum(test)
}
# sample i causal SNPs from k genotypes
snp_num <- 100 ##############
snp <- NULL
snp_af <- NULL
for (i in 1:length(sex)) {
snp_idx <- sample(1:nrow(allele_freq), snp_num)
snp <- cbind(snp, allele_count[snp_idx] )       # row: snp  col: individual
snp_af <- cbind(snp_af, allele_freq$maf[snp_idx])
}
# sample effect size B from normal distribution
Beta <- rnorm(snp_num, mean=0, sd=1)
# genetic variance for each individuals
var_G <- colSums((Beta^2) * snp_af * (1-snp_af))
# environmental variance for males from heritability
h2 <- 0.5 ##############
var_E_m <- (var_G * (1-h2)) / h2
# environmental variance for female based on proportion
E_ratio <- 1.5 ##############
var_E_f <- var_E_m * E_ratio
# environmental effect for males and females from normal distribution
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
# calculate phenotypes from Beta, snp i, and E for j individuals
pheno <- colSums(Beta*snp) + E
### GWAS ###
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
summary(f_model)$coefficients
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
head(f_gwas)
test <- c(1,2,3,4,5,6)
test[1:5]
test[1:5+1]
head(snp)
y=1
test(5)
y=1
test <- function(x) {
return(x+y)
}
test(5)
library(ashr)
library(mashr)
library(ggplot2)
library(reshape2)
setwd("~/Research/GWAS-frontera/mash/simulation")
snp_num <- 100
# create sample of individuals -- random sex
# 0=female  1=male
sex <- rbinom(1000,1,0.5)
f_id <- which(sex==0)
m_id <- which(sex==1)
### SNP ###
# get genotype from binom sampling at site k with allele freq
allele_freq <- read.csv("maf_sample.txt", colClasses = 'numeric')
set.seed(1)
allele_count <- NULL
for (i in 1:nrow(allele_freq)){
test <- rbinom(n=2, size=1, prob=allele_freq$maf[i])
allele_count[i] <- sum(test)
}
# sample i causal SNPs from k genotypes
snp <- NULL
snp_af <- NULL
for (i in 1:length(sex)) {
snp_idx <- sample(1:nrow(allele_freq), snp_num)
snp <- cbind(snp, allele_count[snp_idx] )       # row: snp  col: individual
snp_af <- cbind(snp_af, allele_freq$maf[snp_idx])
}
# sample effect size B from normal distribution
Beta <- rnorm(snp_num, mean=0, sd=1)
### ENV VARIANCE ###
# genetic variance for each individuals
var_G <- colSums((Beta^2) * snp_af * (1-snp_af))
# environmental variance for males from heritability
get_varE_m <- function(h2) {
var_E_m <- (var_G * (1-h2)) / h2
return(var_E_m)
}
# environmental variance for female based on proportion
get_varE_f <- function(E_ratio) {
var_E_f <- var_E_m * E_ratio
return(var_E_f)
}
# environmental effect for males and females from normal distribution
get_E <- function(h2, E_ratio) {
var_E_m <- get_varE_m(h2)
var_E_f <- get_varE_f(E_ratio)
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
return(E)
}
}
# calculate phenotypes from Beta, snp i, and E for j individuals
h2_list <- c(0.5, 0.05)
E_ratio_list <- c(1,1.5,5)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
gwas_mash(E)
}
}
gwas_mash <- function(E) {
### GWAS ###
pheno <- colSums(Beta*snp) + E
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
summary(f_model)$coefficients
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
mash_BETA <-  matrix(c(f_gwas[,1],m_gwas[,1]), nrow=snp_num, ncol=2)
mash_SE <-  matrix(c(f_gwas[,2],m_gwas[,2]), nrow=snp_num, ncol=2)
colnames(mash_BETA) <- c('female','male') ; colnames(mash_SE) <- c('female','male')
### mash ###
data <- mash_set_data(mash_BETA, mash_SE)
# set up covariance matrices
U.c = cov_canonical(data)
corr = c(1,0.75,0.5,0.25,0,-0.25,-0.5,-0.75,-1)
effect = c(1.5,2,3)
for (c in corr) {
for (e in effect) {
U.c[[paste('f',c,e,sep="_")]] <- matrix(c(e^2,c*e,c*e,1),2,2)
U.c[[paste('m',c,e,sep="_")]] <- matrix(c(1,c*e,c*e,e^2),2,2)
}
}
U.c[['equal_-0.25_1']] <- matrix(c(1,-0.25,-0.25,1),2,2)
U.c[['equal_-0.5_1']] <- matrix(c(1,-0.5,-0.5,1),2,2)
U.c[['equal_-0.75_1']] <- matrix(c(1,-0.75,-0.75,1),2,2)
U.c[['equal_-1_1']] <- matrix(c(1,-1,-1,1),2,2)
names(U.c)[1:7] <- c("equal_0_1", "f_0_1", "m_0_1", "equal_1_1", "equal_0.25_1", "equal_0.5_1", "equal_0.75_1")
# fit mash model
m.c <- mash(data,U.c)
mixture <- get_estimated_pi(m.c)
write.table(mixture, file=paste0(snp_num,"_",h2,"_",E_ratio,".txt"),row.names = FALSE, sep="\t")
}
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
gwas_mash(E)
}
}
head(colSums(Beta*snp) + E)
head(snp)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
gwas_mash(E)
}
}
h2_list <- c(0.5, 0.05)
E_ratio_list <- c(1,1.5,5)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
gwas_mash(E)
}
}
h2_list <- c(0.5, 0.05)
E_ratio_list <- c(1,1.5,5)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
#gwas_mash(E)
}
}
h2_list <- c(0.5, 0.05)
E_ratio_list <- c(1,1.5,5)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
pheno <- colSums(Beta*snp) + E
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
summary(f_model)$coefficients
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
mash_BETA <-  matrix(c(f_gwas[,1],m_gwas[,1]), nrow=snp_num, ncol=2)
mash_SE <-  matrix(c(f_gwas[,2],m_gwas[,2]), nrow=snp_num, ncol=2)
colnames(mash_BETA) <- c('female','male') ; colnames(mash_SE) <- c('female','male')
### mash ###
data <- mash_set_data(mash_BETA, mash_SE)
}
}
head(mash_BETA)
head(mash_SE)
data <- mash_set_data(mash_BETA, mash_SE)
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id])
head(m_id)
h2_list <- c(0.5, 0.05)
E_ratio_list <- c(1,1.5,5)
for (E_ratio in E_ratio_list) {
for (h2 in h2_list) {
E <- get_E(h2,E_ratio)
pheno <- colSums(Beta*snp) + E
f_model <- lm(pheno[f_id] ~ t(snp)[f_id,] + E[f_id])
m_model <- lm(pheno[m_id] ~ t(snp)[m_id,] + E[m_id], na.action=na.exclude)
f_gwas <- summary(f_model)$coefficients[1:snp_num+1,1:2]
m_gwas <- summary(m_model)$coefficients[1:snp_num+1,1:2]
mash_BETA <-  matrix(c(f_gwas[,1],m_gwas[,1]), nrow=snp_num, ncol=2)
mash_SE <-  matrix(c(f_gwas[,2],m_gwas[,2]), nrow=snp_num, ncol=2)
colnames(mash_BETA) <- c('female','male') ; colnames(mash_SE) <- c('female','male')
### mash ###
data <- mash_set_data(mash_BETA, mash_SE)
}
}
E
E
# environmental effect for males and females from normal distribution
get_E <- function(h2, E_ratio) {
var_E_m <- get_varE_m(h2)
var_E_f <- get_varE_f(E_ratio)
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
return(E)
}
}
E <- get_E(h2,E_ratio)
E
E <- get_E(h2,E_ratio)
E
# environmental effect for males and females from normal distribution
get_E <- function(h2, E_ratio) {
var_E_m <- get_varE_m(h2)
var_E_f <- get_varE_f(E_ratio)
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
return(E)
}
}
head(var_G)
# environmental effect for males and females from normal distribution
get_E <- function(h2, E_ratio) {
var_E_m <- get_varE_m(h2)
print(head(var_E_m))
var_E_f <- get_varE_f(E_ratio)
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
print(head(E))
return(E)
}
}
E <- get_E(h2,E_ratio)
E <- NULL
for (i in 1:length(sex)) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
E <- NULL
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
E <- NULL
for (i in 1:length(sex)) {
print(i)
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
}
for (i in 1:length(sex)) {
if (sex[i] == 0) {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_f[i]))
} else {
E[i] <- rnorm(1, mean=0, sd=sqrt(var_E_m[i]))
}
print(head(E))
return(E)
}
